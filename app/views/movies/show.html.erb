
<div class="movie-details-container">
  <h1><%= @movie.title %> <span class="year">(<%= @movie.release_year %>)</span></h1>

  <div class="movie-meta-box">
    <p>
      <strong>Sinopse:</strong>
      <span class="detail-content"><%= @movie.synopsis %></span>
    </p>

    <p>
      <strong>Duração:</strong>
      <span class="detail-content"><%= @movie.duration %> minutos</span>
    </p>

    <p>
      <strong>Diretor:</strong>
      <span class="detail-content"><%= @movie.director %></span>
    </p>
  </div>

  <div class="movie-actions-bar">
    <% if user_signed_in? && @movie.user == current_user %>
      <%= link_to "Editar Filme", edit_movie_path(@movie), class: "button primary-button" %> 
      <%# Adicionado a classe delete-button para o estilo vermelho %>
      <%= button_to "Apagar Filme", @movie, method: :delete, data: { confirm: 'Tem certeza?' }, class: "button delete-button" %>
    <% else %>
      <%# Link para voltar, caso o usuário não seja o dono %>
      <%= link_to "Voltar para a lista", movies_path, class: "button primary-button" %>
    <% end %>
  </div>
</div>

<hr class="separator">

<div class="comments-section">
  <h2><%= @movie.comments.count %> Comentários</h2>

  <div id="comments">
    <% @comments.each do |comment| %>
      <%# Aplicado estilo de card para cada comentário %>
      <div class="comment-card">
        <div class="comment-header">
          <strong>
            <% if comment.user %>
              <%= comment.user.email %> 
            <% else %>
              <%= comment.commenter_name %> (Anônimo)
            <% end %>
          </strong>
          <small class="comment-time"><%= time_ago_in_words(comment.created_at) %> atrás</small>
        </div>
        
        <p class="comment-content"><%= comment.content %></p>
        
        <% if user_signed_in? && comment.user == current_user %>
          <%# Botão de apagar estilizado %>
          <%= button_to 'Apagar', movie_comment_path(@movie, comment), method: :delete, data: { confirm: 'Tem certeza?' }, class: 'delete-comment-button' %>
        <% end %>
      </div>
    <% end %>
  </div>

  <br>

  <h3>Adicionar um novo comentário:</h3>

  <%# O @comment foi inicializado no MoviesController#show %>
  <%= form_with(model: [@movie, @comment], local: true, class: "comment-form") do |form| %>
    
    <%# Exibe erros de validação se houver %>
    <% if @comment.errors.any? %>
      <div id="error_explanation" class="alert">
        <h2><%= pluralize(@comment.errors.count, "erro") %> impediu este comentário de ser salvo:</h2>
        <ul>
          <% @comment.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <% unless user_signed_in? %>
      <div class="field">
        <%= form.label :commenter_name, "Seu Nome (Anônimo)" %>
        <%= form.text_field :commenter_name %>
      </div>
    <% end %>

    <div class="field">
      <%= form.label :content, "Comentário" %>
      <%= form.text_area :content, rows: 4 %>
    </div>

    <div class="actions">
      <%= form.submit "Postar Comentário" %>
    </div>
  <% end %> 
  
  <br>
  <%= link_to "Voltar para a lista de filmes", movies_path, class: "button" %>
</div>

<style>
/* Estilos Específicos para Detalhes do Filme e Comentários */

.movie-details-container {
    background-color: white;
    border-radius: 8px;
    padding: 30px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.movie-details-container h1 {
    color: #0b2d4f;
    border-bottom: 3px solid #f0f0f0;
}

.year {
    font-size: 0.7em;
    color: #666;
    font-weight: normal;
    margin-left: 10px;
}

.movie-meta-box {
    padding: 15px 0;
}

.movie-meta-box p {
    margin-bottom: 10px;
}

.movie-meta-box strong {
    color: #1f4068;
    display: inline-block;
    min-width: 100px;
}

.movie-actions-bar {
    padding-top: 15px;
    border-top: 1px solid #eee;
    display: flex;
    gap: 15px;
}

/* Estilos de Comentários */
.comments-section {
    margin-top: 30px;
}

.comment-card {
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    position: relative;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.comment-header strong {
    color: #1f4068;
}

.comment-time {
    color: #999;
    font-size: 0.9em;
    margin-left: 10px;
}

.comment-content {
    margin-top: 8px;
    margin-bottom: 0;
}

.delete-comment-button {
    background-color: #e57373;
    color: white;
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8em;
    float: right;
    transition: background-color 0.3s;
}

.delete-comment-button:hover {
    background-color: #d32f2f;
}

.comment-form {
    margin-top: 20px;
    padding: 20px;
    background-color: #f0f4f7;
    border-radius: 8px;
    border: 1px solid #ddd;
}
</style>
